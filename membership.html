<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Member Dashboard - Prekebena Family Dynasty</title>

<link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700&display=swap" rel="stylesheet">
<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>

<style>
    body {
        margin: 0;
        background: #f4f4f4;
        font-family: 'Inter', sans-serif;
    }

    header {
        background: #022c43;
        color: white;
        padding: 15px 20px;
        display: flex;
        justify-content: space-between;
        align-items: center;
    }

    header .logo {
        display: flex;
        align-items: center;
        gap: 10px;
    }

    header img {
        width: 45px;
        border-radius: 10px;
    }

    header h2 {
        margin: 0;
        font-size: 20px;
        font-weight: 700;
    }

    header button {
        background: #ffcf33;
        border: none;
        padding: 8px 14px;
        border-radius: 6px;
        font-weight: 700;
        cursor: pointer;
    }

    .container {
        max-width: 900px;
        margin: 20px auto;
        padding: 20px;
    }

    .section {
        background: white;
        padding: 20px;
        border-radius: 12px;
        margin-bottom: 25px;
        box-shadow: 0px 6px 20px rgba(0,0,0,0.05);
    }

    h3 {
        margin-top: 0;
        color: #022c43;
    }

    .profile-box {
        display: flex;
        gap: 20px;
        align-items: center;
    }

    .profile-box img {
        width: 90px;
        height: 90px;
        border-radius: 12px;
        object-fit: cover;
        border: 2px solid #022c43;
    }

    table {
        width: 100%;
        border-collapse: collapse;
        margin-top: 15px;
    }

    th, td {
        padding: 12px;
        border-bottom: 1px solid #ddd;
        font-size: 14px;
    }

    th {
        background: #022c43;
        color: white;
        text-align: left;
    }

    @media (max-width: 600px) {
        .profile-box {
            flex-direction: column;
            text-align: center;
        }
    }
</style>
</head>
<body>

<header>
    <div class="logo">
        <img src="assets/WhatsApp Image 2025-12-10 at 11.28.12 AM.jpeg">
        <h2>Member Dashboard</h2>
    </div>
    <button onclick="logout()">Logout</button>
</header>

<div class="container">

    <!-- PROFILE SECTION -->
    <div class="section">
        <h3>Your Profile</h3>
        <div class="profile-box">
            <img id="profilePicture" src="">
            <div>
                <p><strong>Name:</strong> <span id="memberName"></span></p>
                <p><strong>Email:</strong> <span id="memberEmail"></span></p>
                <p><strong>Phone:</strong> <span id="memberPhone"></span></p>
            </div>
        </div>
    </div>

    <!-- DUES HISTORY -->
    <div class="section">
        <h3>Monthly Dues History</h3>
        <table>
            <thead>
                <tr>
                    <th>Month</th>
                    <th>Amount</th>
                    <th>Status</th>
                    <th>Updated By</th>
                </tr>
            </thead>
            <tbody id="duesTable"></tbody>
        </table>
    </div>

    <!-- ANNOUNCEMENTS -->
    <div class="section">
        <h3>Announcements</h3>
        <div id="announcementBox">Loading...</div>
    </div>

    <!-- UPCOMING EVENTS -->
    <div class="section">
        <h3>Upcoming Events</h3>
        <div id="eventsBox">Loading...</div>
    </div>

</div>

<script>
const webAppURL = "https://script.google.com/macros/s/AKfycby1sItf5eLHAcojxuWcVnSF0lQi_6kF9XWNcEypQr8NRzkMfya4bpz_aqjEqWjVFcDO/exec";

// -----------------------------------------------------
// 1. REDIRECT IF NOT LOGGED IN
// -----------------------------------------------------
const user = sessionStorage.getItem("memberData");
if (!user) {
    window.location.href = "login.html";
}

const userData = JSON.parse(user);

// Fill profile data
document.getElementById("memberName").textContent = userData.name;
document.getElementById("memberEmail").textContent = userData.email;
document.getElementById("memberPhone").textContent = userData.phone;
document.getElementById("profilePicture").src =
    userData.imageUrl && userData.imageUrl !== "" ? userData.imageUrl : "assets/user.png";

// -----------------------------------------------------
// 2. LOAD DUES HISTORY
// -----------------------------------------------------
async function loadDues() {
    const params = new URLSearchParams();
    params.append("action", "getDues");
    params.append("email", userData.email);

    const res = await fetch(webAppURL, { method: "POST", body: params });
    const json = await res.json();

    const table = document.getElementById("duesTable");
    table.innerHTML = "";

    json.forEach(row => {
        table.innerHTML += `
            <tr>
                <td>${row.month}</td>
                <td>${row.amount}</td>
                <td>${row.status}</td>
                <td>${row.updatedBy}</td>
            </tr>
        `;
    });
}

// -----------------------------------------------------
// 3. LOAD ANNOUNCEMENTS
// -----------------------------------------------------
async function loadAnnouncements() {
    const params = new URLSearchParams();
    params.append("action", "getAnnouncements");

    const res = await fetch(webAppURL, { method: "POST", body: params });
    const json = await res.json();

    const box = document.getElementById("announcementBox");
    box.innerHTML = "";

    json.forEach(a => {
        box.innerHTML += `<p>ðŸ“¢ <strong>${a.title}</strong><br>${a.message}</p><hr>`;
    });
}

// -----------------------------------------------------
// 4. LOAD EVENTS
// -----------------------------------------------------
async function loadEvents() {
    const params = new URLSearchParams();
    params.append("action", "getEvents");

    const res = await fetch(webAppURL, { method: "POST", body: params });
    const json = await res.json();

    const box = document.getElementById("eventsBox");
    box.innerHTML = "";

    json.forEach(e => {
        box.innerHTML += `<p>ðŸ“… <strong>${e.title}</strong><br>${e.date}</p><hr>`;
    });
}

// -----------------------------------------------------
// 5. LOAD EVERYTHING
// -----------------------------------------------------
loadDues();
loadAnnouncements();
loadEvents();

// -----------------------------------------------------
// 6. LOGOUT
// -----------------------------------------------------
function logout() {
    sessionStorage.clear();
    window.location.href = "login.html";
}
</script>

</body>
</html>
